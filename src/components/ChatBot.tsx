
import { useState, useRef, useEffect } from 'react';
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import { ArrowLeft, Send, Bot, User, Globe, Heart, Stethoscope } from "lucide-react";
import { toast } from "@/hooks/use-toast";

interface Message {
  id: string;
  text: string;
  sender: 'user' | 'bot';
  timestamp: Date;
  language: string;
}

interface ChatBotProps {
  onBack: () => void;
}

const ChatBot = ({ onBack }: ChatBotProps) => {
  const [messages, setMessages] = useState<Message[]>([]);
  const [inputText, setInputText] = useState('');
  const [selectedLanguage, setSelectedLanguage] = useState('en');
  const [isTyping, setIsTyping] = useState(false);
  const messagesEndRef = useRef<HTMLDivElement>(null);

  const languages = [
    { code: 'en', name: 'English' },
    { code: 'hi', name: 'рд╣рд┐рдВрджреА (Hindi)' },
    { code: 'te', name: 'р░др▒Жр░▓р▒Бр░Чр▒Б (Telugu)' },
    { code: 'ta', name: 'родрооро┐ро┤рпН (Tamil)' },
    { code: 'bn', name: 'ржмрж╛ржВрж▓рж╛ (Bengali)' },
    { code: 'es', name: 'Espa├▒ol (Spanish)' },
    { code: 'fr', name: 'Fran├зais (French)' }
  ];

  const scrollToBottom = () => {
    messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
  };

  useEffect(() => {
    scrollToBottom();
  }, [messages]);

  useEffect(() => {
    // Welcome message
    const welcomeMessages = {
      en: "Hello there! ЁЯСЛ I'm ArogyaMitra's friendly medical assistant. I'm here to help you understand your health better! Whether you're feeling unwell or just curious about staying healthy, I'm here for you. What would you like to know today? ЁЯй║",
      hi: "рдирдорд╕реНрддреЗ! ЁЯСЛ рдореИрдВ рдЖрд░реЛрдЧреНрдпрдорд┐рддреНрд░ рдХрд╛ рджреЛрд╕реНрддрд╛рдирд╛ рдЪрд┐рдХрд┐рддреНрд╕рд╛ рд╕рд╣рд╛рдпрдХ рд╣реВрдБред рдореИрдВ рдЖрдкрдХреЛ рдЕрдкрдиреЗ рд╕реНрд╡рд╛рд╕реНрдереНрдп рдХреЛ рдмреЗрд╣рддрд░ рд╕рдордЭрдиреЗ рдореЗрдВ рдорджрдж рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдпрд╣рд╛рдБ рд╣реВрдБ! рдЖрдЬ рдЖрдк рдХреНрдпрд╛ рдЬрд╛рдирдирд╛ рдЪрд╛рд╣реЗрдВрдЧреЗ? ЁЯй║",
      te: "р░ир░ор░╕р▒Нр░Хр░╛р░░р░В! ЁЯСЛ р░ир▒Зр░ир▒Б р░Жр░░р▒Лр░Чр▒Нр░пр░ор░┐р░др▒Нр░░ р░пр▒Кр░Хр▒Нр░Х р░╕р▒Нр░ир▒Зр░╣р░кр▒Вр░░р▒Нр░╡р░Х р░╡р▒Ир░жр▒Нр░п р░╕р░╣р░╛р░пр░Хр▒Бр░бр░┐р░ир░┐. р░ор▒А р░Жр░░р▒Лр░Чр▒Нр░пр░╛р░ир▒Нр░ир░┐ р░ор▒Жр░░р▒Бр░Чр▒Нр░Чр░╛ р░Ер░░р▒Нр░ер░В р░Ър▒Зр░╕р▒Бр░Хр▒Лр░╡р░бр░Вр░▓р▒Л р░╕р░╣р░╛р░пр░кр░бр░Яр░╛р░ир░┐р░Хр░┐ р░ир▒Зр░ир▒Б р░Зр░Хр▒Нр░Хр░б р░Йр░ир▒Нр░ир░╛р░ир▒Б! ЁЯй║",
      ta: "ро╡рогроХрпНроХроорпН! ЁЯСЛ роиро╛ройрпН роЖро░рпЛроХрпНропрооро┐родрпНро░ро╛ро╡ро┐ройрпН роироЯрпНрокро╛рой рооро░рпБродрпНродрпБро╡ роЙродро╡ро┐ропро╛ро│ро░рпН. роЙроЩрпНроХро│рпН роЖро░рпЛроХрпНроХро┐ропродрпНродрпИ роЪро┐ро▒рокрпНрокро╛роХ рокрпБро░ро┐роирпНродрпБроХрпКро│рпНро│ роЙродро╡ роиро╛ройрпН роЗроЩрпНроХрпЗ роЗро░рпБроХрпНроХро┐ро▒рпЗройрпН! ЁЯй║",
      bn: "ржиржорж╕рзНржХрж╛рж░! ЁЯСЛ ржЖржорж┐ ржЖрж░рзЛржЧрзНржпржорж┐рждрзНрж░рзЗрж░ ржмржирзНржзрзБрждрзНржмржкрзВрж░рзНржг ржЪрж┐ржХрж┐рзОрж╕ржХ рж╕рж╣рж╛ржпрж╝ржХред ржЖржкржирж╛рж░ рж╕рзНржмрж╛рж╕рзНржерзНржп ржнрж╛рж▓рзЛржнрж╛ржмрзЗ ржмрзБржЭрждрзЗ рж╕рж╛рж╣рж╛ржпрзНржп ржХрж░рж╛рж░ ржЬржирзНржп ржЖржорж┐ ржПржЦрж╛ржирзЗ ржЖржЫрж┐! ЁЯй║",
      es: "┬бHola! ЁЯСЛ Soy el asistente m├йdico amigable de ArogyaMitra. ┬бEstoy aqu├н para ayudarte a entender mejor tu salud! ЁЯй║",
      fr: "Bonjour! ЁЯСЛ Je suis l'assistant m├йdical amical d'ArogyaMitra. Je suis l├а pour vous aider ├а mieux comprendre votre sant├й! ЁЯй║"
    };

    setMessages([{
      id: '1',
      text: welcomeMessages[selectedLanguage as keyof typeof welcomeMessages] || welcomeMessages.en,
      sender: 'bot',
      timestamp: new Date(),
      language: selectedLanguage
    }]);
  }, [selectedLanguage]);

  const getMedicalResponse = (userMessage: string, language: string): string => {
    const lowerMessage = userMessage.toLowerCase();
    
    // Medical responses in different languages
    const responses = {
      en: {
        fever: "Oh no! ЁЯдТ You have a fever. Don't worry, I'm here to help! Fever means your body is fighting off germs - you're like a superhero inside! ЁЯж╕тАНтЩАя╕П\n\nтЬи What you can do:\nтАв Rest like a sleeping bear ЁЯР╗\nтАв Drink lots of water (imagine you're a plant!) ЁЯМ▒\nтАв Take medicine if an adult says it's okay ЁЯТК\nтАв Use a cool cloth on your forehead тЭДя╕П\n\nЁЯЪи Ask an adult to call a doctor if:\nтАв Your fever is very high (over 102┬░F)\nтАв You have trouble breathing\nтАв You feel very sick for more than 3 days\n\nTell me, do you have any other symptoms? ЁЯдЧ",
        headache: "Ouch! ЁЯШФ Your head hurts! Let's make it feel better together! ЁЯМЯ\n\nтЬи Try these gentle remedies:\nтАв Rest in a quiet, dark room like a cozy cave ЁЯПа\nтАв Drink water slowly - your brain needs it! ЁЯТз\nтАв Put a soft, cool cloth on your head ЁЯзК\nтАв Take deep breaths like you're smelling flowers ЁЯМ╕\nтАв Gentle head massage from someone you trust ЁЯСР\n\nЁЯЪи Get help right away if:\nтАв Your head hurts very, very badly\nтАв You can't see well\nтАв Your neck feels stiff\nтАв You feel confused\n\nWhat do you think might have caused your headache? ЁЯдФ",
        cold: "Achoo! ЁЯдз You caught a cold! Don't worry, colds are very common and you'll feel better soon! ЁЯМИ\n\nтЬи Let's fight this cold together:\nтАв Rest lots - your body is working hard! ЁЯШ┤\nтАв Drink warm soup (it's like a hug for your throat!) ЁЯН▓\nтАв Honey and warm water can soothe your throat ЁЯНп\nтАв Breathe steam from a warm shower ЁЯЪ┐\nтАв Wash your hands often to keep germs away! ЁЯз╝\n\nЁЯМЯ Fun fact: Your body makes about 2 liters of mucus every day!\n\nYou should feel better in 7-10 days. Tell an adult if you feel much worse! ЁЯТк",
        default: "Hello my friend! ЁЯШК I want to help you feel better! Can you tell me more about how you're feeling? ЁЯдЧ\n\nЁЯМЯ To help you better, please tell me:\nтАв What part of your body doesn't feel good? ЁЯСд\nтАв When did you start feeling this way? тП░\nтАв Does anything make it feel better or worse? ЁЯд╖тАНтЩАя╕П\n\nЁЯТб Remember: I'm here to help, but always talk to a grown-up you trust about your health! ЁЯСитАНтЪХя╕ПЁЯСйтАНтЪХя╕П\n\nYou're brave for asking about your health! ЁЯж╕тАНтЩВя╕П"
      },
      hi: {
        fever: "рдЕрд░реЗ! ЁЯдТ рдЖрдкрдХреЛ рдмреБрдЦрд╛рд░ рд╣реИ! рдЪрд┐рдВрддрд╛ рдордд рдХрд░реЛ, рдореИрдВ рдЖрдкрдХреА рдорджрдж рдХрд░реВрдВрдЧрд╛! рдмреБрдЦрд╛рд░ рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдЖрдкрдХрд╛ рд╢рд░реАрд░ рдХреАрдЯрд╛рдгреБрдУрдВ рд╕реЗ рд▓рдбрд╝ рд░рд╣рд╛ рд╣реИ - рдЖрдк рдЕрдВрджрд░ рд╕реЗ рдПрдХ рд╕реБрдкрд░рд╣реАрд░реЛ рдХреА рддрд░рд╣ рд╣реИрдВ! ЁЯж╕тАНтЩАя╕П\n\nтЬи рдЖрдк рдпрд╣ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:\nтАв рднрд╛рд▓реВ рдХреА рддрд░рд╣ рдЖрд░рд╛рдо рдХрд░реЗрдВ ЁЯР╗\nтАв рдЦреВрдм рдкрд╛рдиреА рдкрд┐рдПрдВ ЁЯМ▒\nтАв рдЕрдЧрд░ рдХреЛрдИ рдмрдбрд╝рд╛ рдХрд╣реЗ рддреЛ рджрд╡рд╛ рд▓реЗрдВ ЁЯТК\nтАв рдорд╛рдереЗ рдкрд░ рдардВрдбрд╛ рдХрдкрдбрд╝рд╛ рд░рдЦреЗрдВ тЭДя╕П\n\nЁЯЪи рдХрд┐рд╕реА рдмрдбрд╝реЗ рд╕реЗ рдбреЙрдХреНрдЯрд░ рдХреЛ рдмреБрд▓рд╡рд╛рдПрдВ рдЕрдЧрд░:\nтАв рдмреБрдЦрд╛рд░ рдмрд╣реБрдд рддреЗрдЬрд╝ рд╣реИ\nтАв рд╕рд╛рдВрд╕ рд▓реЗрдиреЗ рдореЗрдВ рддрдХрд▓реАрдл рд╣реЛ\nтАв 3 рджрд┐рди рд╕реЗ рдЬреНрдпрд╛рджрд╛ рдмреАрдорд╛рд░ рдорд╣рд╕реВрд╕ рдХрд░реЗрдВ\n\nрдмрддрд╛рдЗрдП, рдХреНрдпрд╛ рдХреЛрдИ рдФрд░ рд▓рдХреНрд╖рдг рд╣реИ? ЁЯдЧ",
        headache: "рдЕрд░реЗ! ЁЯШФ рдЖрдкрдХреЗ рд╕рд┐рд░ рдореЗрдВ рджрд░реНрдж рд╣реИ! рдЖрдЗрдП рдорд┐рд▓рдХрд░ рдЗрд╕реЗ рдареАрдХ рдХрд░рддреЗ рд╣реИрдВ! ЁЯМЯ\n\nтЬи рдпреЗ рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВ:\nтАв рд╢рд╛рдВрдд, рдЕрдВрдзреЗрд░реЗ рдХрдорд░реЗ рдореЗрдВ рдЖрд░рд╛рдо рдХрд░реЗрдВ ЁЯПа\nтАв рдзреАрд░реЗ-рдзреАрд░реЗ рдкрд╛рдиреА рдкрд┐рдПрдВ ЁЯТз\nтАв рд╕рд┐рд░ рдкрд░ рдирд░рдо, рдардВрдбрд╛ рдХрдкрдбрд╝рд╛ рд░рдЦреЗрдВ ЁЯзК\nтАв рдлреВрд▓реЛрдВ рдХреА рддрд░рд╣ рд╕рд╛рдВрд╕ рд▓реЗрдВ ЁЯМ╕\n\nЁЯЪи рддреБрд░рдВрдд рдорджрдж рд▓реЗрдВ рдЕрдЧрд░:\nтАв рд╕рд┐рд░ рдореЗрдВ рдмрд╣реБрдд рддреЗрдЬрд╝ рджрд░реНрдж рд╣реЛ\nтАв рджреЗрдЦрдиреЗ рдореЗрдВ рдкрд░реЗрд╢рд╛рдиреА рд╣реЛ\nтАв рдЧрд░реНрджрди рдЕрдХрдбрд╝ рдЬрд╛рдП\n\nрдХреНрдпрд╛ рд▓рдЧрддрд╛ рд╣реИ рд╕рд┐рд░рджрд░реНрдж рдХрд╛ рдХрд╛рд░рдг рдХреНрдпрд╛ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ? ЁЯдФ",
        cold: "рд╣реИрдВ-рдЪреА! ЁЯдз рдЖрдкрдХреЛ рд╕рд░реНрджреА-рдЬреБрдХрд╛рдо рд╣реБрдЖ рд╣реИ! рдЪрд┐рдВрддрд╛ рди рдХрд░реЗрдВ, рдпрд╣ рдЖрдо рдмрд╛рдд рд╣реИ рдФрд░ рдЬрд▓реНрджреА рдареАрдХ рд╣реЛ рдЬрд╛рдПрдЧрд╛! ЁЯМИ\n\nтЬи рдЖрдЗрдП рдорд┐рд▓рдХрд░ рдЗрд╕рд╕реЗ рд▓рдбрд╝рддреЗ рд╣реИрдВ:\nтАв рдЦреВрдм рдЖрд░рд╛рдо рдХрд░реЗрдВ ЁЯШ┤\nтАв рдЧрд░реНрдо рд╕реВрдк рдкрд┐рдПрдВ ЁЯН▓\nтАв рд╢рд╣рдж рдФрд░ рдЧрд░реНрдо рдкрд╛рдиреА рд╕реЗ рдЧрд▓реЗ рдХреЛ рдЖрд░рд╛рдо рджреЗрдВ ЁЯНп\nтАв рдЧрд░реНрдо рдкрд╛рдиреА рдХреА рднрд╛рдк рд▓реЗрдВ ЁЯЪ┐\n\nрдЖрдк 7-10 рджрд┐рди рдореЗрдВ рдмреЗрд╣рддрд░ рдорд╣рд╕реВрд╕ рдХрд░реЗрдВрдЧреЗред рдЕрдЧрд░ рдЬреНрдпрд╛рджрд╛ рдмреАрдорд╛рд░ рд▓рдЧреЗрдВ рддреЛ рдХрд┐рд╕реА рдмрдбрд╝реЗ рдХреЛ рдмрддрд╛рдПрдВ! ЁЯТк",
        default: "рдирдорд╕реНрддреЗ рдореЗрд░реЗ рджреЛрд╕реНрдд! ЁЯШК рдореИрдВ рдЖрдкрдХреЛ рдмреЗрд╣рддрд░ рдорд╣рд╕реВрд╕ рдХрд░рд╛рдиреЗ рдореЗрдВ рдорджрдж рдХрд░рдирд╛ рдЪрд╛рд╣рддрд╛ рд╣реВрдВ! рдЖрдк рдХреИрд╕рд╛ рдорд╣рд╕реВрд╕ рдХрд░ рд░рд╣реЗ рд╣реИрдВ? ЁЯдЧ\n\nЁЯМЯ рдмреЗрд╣рддрд░ рдорджрдж рдХреЗ рд▓рд┐рдП рдмрддрд╛рдПрдВ:\nтАв рд╢рд░реАрд░ рдХрд╛ рдХреМрди рд╕рд╛ рд╣рд┐рд╕реНрд╕рд╛ рдареАрдХ рдирд╣реАрдВ рд▓рдЧ рд░рд╣рд╛?\nтАв рдпрд╣ рдХрдм рд╕реЗ рдорд╣рд╕реВрд╕ рд╣реЛ рд░рд╣рд╛ рд╣реИ?\n\nрдЖрдк рдмрд╣реБрдд рдмрд╣рд╛рджреБрд░ рд╣реИрдВ! ЁЯж╕тАНтЩВя╕П"
      },
      te: {
        fever: "р░Ер░пр▒Нр░пр▒Л! ЁЯдТ р░ор▒Ар░Хр▒Б р░Ьр▒Нр░╡р░░р░В р░╡р░Ър▒Нр░Ър░┐р░Вр░жр░╛! р░Ър░┐р░Вр░д р░Ър▒Зр░пр░Хр░Вр░бр░┐, р░ир▒Зр░ир▒Б р░ор▒Ар░Хр▒Б р░╕р░╣р░╛р░пр░В р░Ър▒Зр░╕р▒Нр░др░╛р░ир▒Б! ЁЯж╕тАНтЩАя╕П\n\nтЬи р░ор▒Ар░░р▒Б р░Зр░╡р░┐ р░Ър▒Зр░пр░╡р░Ър▒Нр░Ър▒Б:\nтАв р░Ор░▓р▒Бр░Чр▒Бр░мр░Вр░Яр░┐р░▓р░╛ р░╡р░┐р░╢р▒Нр░░р░ор░┐р░Вр░Ър░Вр░бр░┐ ЁЯР╗\nтАв р░Ър░╛р░▓р░╛ р░ир▒Ар░│р▒Нр░▓р▒Б р░др░╛р░Чр░Вр░бр░┐ ЁЯМ▒\nтАв р░кр▒Жр░жр▒Нр░жр░▓р▒Б р░Ър▒Жр░кр▒Нр░кр░┐р░др▒З р░ор░Вр░жр▒Б р░др▒Ар░╕р▒Бр░Хр▒Лр░Вр░бр░┐ ЁЯТК\n\nр░ор░░р▒Зр░ор▒Ир░ир░╛ р░▓р░Хр▒Нр░╖р░гр░╛р░▓р▒Б р░Йр░ир▒Нр░ир░╛р░пр░╛? ЁЯдЧ",
        headache: "р░Ер░пр▒Нр░пр▒Л! ЁЯШФ р░др░▓ р░ир▒Кр░кр▒Нр░кр░┐р░Чр░╛ р░Йр░Вр░жр░╛! р░Хр░▓р░┐р░╕р░┐ р░жр░╛р░ир▒Нр░ир░┐ р░мр░╛р░Чр▒Б р░Ър▒Зр░жр▒Нр░жр░╛р░В! ЁЯМЯ\n\nтЬи р░Зр░╡р░┐ р░кр▒Нр░░р░пр░др▒Нр░ир░┐р░Вр░Ър░Вр░бр░┐:\nтАв р░ир░┐р░╢р▒Нр░╢р░мр▒Нр░ж, р░Ър▒Ар░Хр░Яр░┐ р░Чр░жр░┐р░▓р▒Л р░╡р░┐р░╢р▒Нр░░р░ор░┐р░Вр░Ър░Вр░бр░┐ ЁЯПа\nтАв р░ор▒Жр░▓р▒Нр░▓р░Чр░╛ р░ир▒Ар░│р▒Нр░▓р▒Б р░др░╛р░Чр░Вр░бр░┐ ЁЯТз\n\nр░др░▓р░ир▒Кр░кр▒Нр░кр░┐р░Хр░┐ р░Хр░╛р░░р░гр░В р░Пр░ор░┐р░Яр░ир░┐ р░Ер░ир▒Бр░Хр▒Бр░Вр░Яр▒Бр░ир▒Нр░ир░╛р░░р▒Б? ЁЯдФ",
        cold: "р░╣р░╛р░Ър▒В! ЁЯдз р░ор▒Ар░Хр▒Б р░Ьр░▓р▒Бр░мр▒Б р░╡р░Ър▒Нр░Ър░┐р░Вр░жр░╛! р░Ър░┐р░Вр░д р░Ър▒Зр░пр░Хр░Вр░бр░┐, р░др▒Нр░╡р░░р░Чр░╛ р░мр░╛р░Чр▒Бр░кр░бр░др░╛р░░р▒Б! ЁЯМИ\n\nтЬи р░Хр░▓р░┐р░╕р░┐ р░жр▒Ар░ир░┐р░др▒Л р░кр▒Лр░░р░╛р░бр▒Бр░жр░╛р░В:\nтАв р░Ър░╛р░▓р░╛ р░╡р░┐р░╢р▒Нр░░р░ор░┐р░Вр░Ър░Вр░бр░┐ ЁЯШ┤\nтАв р░╡р▒Зр░бр░┐ р░╕р▒Вр░кр▒Н р░др░╛р░Чр░Вр░бр░┐ ЁЯН▓\n\n7-10 р░░р▒Лр░Ьр▒Бр░▓р▒Нр░▓р▒Л р░мр░╛р░Чр▒Бр░кр░бр░др░╛р░░р▒Б! ЁЯТк",
        default: "р░╣р░▓р▒Л р░ир░╛ р░╕р▒Нр░ир▒Зр░╣р░┐р░др▒Бр░бр░╛! ЁЯШК р░ор▒Ар░Хр▒Б р░ор░Вр░Ър░┐р░Чр░╛ р░Ер░ир░┐р░кр░┐р░Вр░Ър▒Зр░▓р░╛ р░╕р░╣р░╛р░пр░В р░Ър▒Зр░пр░╛р░▓р░ир▒Бр░Хр▒Бр░Вр░Яр▒Бр░ир▒Нр░ир░╛р░ир▒Б! ЁЯдЧ\n\nЁЯМЯ р░ор▒Ар░░р▒Б р░Ор░▓р░╛ р░Ер░ир░┐р░кр░┐р░╕р▒Нр░др▒Бр░ир▒Нр░ир░╛р░░р▒Л р░Ър▒Жр░кр▒Нр░кр░Вр░бр░┐:\nтАв р░╢р░░р▒Ар░░р░Вр░▓р▒Л р░П р░нр░╛р░Чр░В р░мр░╛р░Чр▒Лр░▓р▒Зр░жр▒Б?\nтАв р░Ор░кр▒Нр░кр░Яр░┐ р░ир▒Бр░Вр░бр░┐ р░Ер░ир░┐р░кр░┐р░╕р▒Нр░др▒Лр░Вр░жр░┐?\n\nр░ор▒Ар░░р▒Б р░Ър░╛р░▓р░╛ р░зр▒Ир░░р▒Нр░пр░╡р░Вр░др▒Бр░▓р▒Б! ЁЯж╕тАНтЩВя╕П"
      },
      ta: {
        fever: "роЕропрпНропрпЛ! ЁЯдТ роЙроЩрпНроХро│рпБроХрпНроХрпБ роХро╛ропрпНроЪрпНроЪро▓рпН ро╡роирпНродрпБро│рпНро│родрпБ! роХро╡ро▓рпИрокрпНрокроЯро╛родрпАро░рпНроХро│рпН, роиро╛ройрпН роЙроЩрпНроХро│рпБроХрпНроХрпБ роЙродро╡рпБроХро┐ро▒рпЗройрпН! ЁЯж╕тАНтЩАя╕П\n\nтЬи роирпАроЩрпНроХро│рпН роЗродрпИроЪрпН роЪрпЖропрпНропро▓ро╛роорпН:\nтАв роХро░роЯро┐ропрпИрокрпН рокрпЛро▓ роУропрпНро╡рпБ роОроЯрпБроЩрпНроХро│рпН ЁЯР╗\nтАв роиро┐ро▒рпИроп родрогрпНрогрпАро░рпН роХрпБроЯро┐ропрпБроЩрпНроХро│рпН ЁЯМ▒\n\nро╡рпЗро▒рпБ роПродрпЗройрпБроорпН роЕро▒ро┐роХрпБро▒ро┐роХро│рпН роЗро░рпБроХрпНроХро┐ройрпНро▒ройро╡ро╛? ЁЯдЧ",
        headache: "роЕропрпНропрпЛ! ЁЯШФ родро▓рпИро╡ро▓ро┐ роЗро░рпБроХрпНроХро┐ро▒родро╛! роЪрпЗро░рпНроирпНродрпБ роЕродрпИ роЪро░ро┐роЪрпЖропрпНро╡рпЛроорпН! ЁЯМЯ\n\nтЬи роЗро╡ро▒рпНро▒рпИ роорпБропро▒рпНроЪро┐роХрпНроХро╡рпБроорпН:\nтАв роЕроорпИродро┐ропро╛рой, роЗро░рпБрогрпНроЯ роЕро▒рпИропро┐ро▓рпН роУропрпНро╡рпБ роОроЯрпБроЩрпНроХро│рпН ЁЯПа\nтАв роорпЖродрпБро╡ро╛роХ родрогрпНрогрпАро░рпН роХрпБроЯро┐ропрпБроЩрпНроХро│рпН ЁЯТз\n\nродро▓рпИро╡ро▓ро┐роХрпНроХрпБ роОройрпНрой роХро╛ро░рогроорпН роОройрпНро▒рпБ роиро┐ройрпИроХрпНроХро┐ро▒рпАро░рпНроХро│рпН? ЁЯдФ",
        cold: "ро╣ро╛роЪрпНроЪрпВ! ЁЯдз роЙроЩрпНроХро│рпБроХрпНроХрпБ роЪро│ро┐ рокро┐роЯро┐родрпНродрпБро│рпНро│родрпБ! роХро╡ро▓рпИрокрпНрокроЯро╛родрпАро░рпНроХро│рпН, ро╡ро┐ро░рпИро╡ро┐ро▓рпН роХрпБрогрооро╛роХро┐ро╡ро┐роЯрпБроорпН! ЁЯМИ\n\nтЬи роЗродрпИ роОродро┐ро░рпНродрпНродрпБрокрпН рокрпЛро░ро╛роЯрпБро╡рпЛроорпН:\nтАв роиро┐ро▒рпИроп роУропрпНро╡рпБ роОроЯрпБроЩрпНроХро│рпН ЁЯШ┤\nтАв роЪрпВроЯро╛рой роЪрпВрокрпН роХрпБроЯро┐ропрпБроЩрпНроХро│рпН ЁЯН▓\n\n7-10 роиро╛роЯрпНроХро│ро┐ро▓рпН роиройрпНро▒ро╛роХ роЙрогро░рпБро╡рпАро░рпНроХро│рпН! ЁЯТк",
        default: "ро╡рогроХрпНроХроорпН роОройрпН роирогрпНрокро░рпЗ! ЁЯШК роЙроЩрпНроХро│рпБроХрпНроХрпБ роиро▓рпНро▓родрпБ рокрпЛро▓рпН роЙрогро░ роЙродро╡ ро╡ро┐ро░рпБроорпНрокрпБроХро┐ро▒рпЗройрпН! ЁЯдЧ\n\nЁЯМЯ роЪро┐ро▒роирпНрод роЙродро╡ро┐роХрпНроХро╛роХ роЪрпКро▓рпНро▓рпБроЩрпНроХро│рпН:\nтАв роЙроЯро▓ро┐ройрпН роОроирпНродрокрпН рокроХрпБродро┐ роЪро░ро┐ропро┐ро▓рпНро▓рпИ?\nтАв роОрокрпНрокрпЛродро┐ро▓ро┐ро░рпБроирпНродрпБ роЗрокрпНрокроЯро┐ роЙрогро░рпНроХро┐ро▒рпАро░рпНроХро│рпН?\n\nроирпАроЩрпНроХро│рпН рооро┐роХро╡рпБроорпН родрпИро░ро┐ропрооро╛ройро╡ро░рпН! ЁЯж╕тАНтЩВя╕П"
      },
      bn: {
        fever: "рж╣рж╛ржпрж╝! ЁЯдТ ржЖржкржирж╛рж░ ржЬрзНржмрж░ рж╣ржпрж╝рзЗржЫрзЗ! ржЪрж┐ржирзНрждрж╛ ржХрж░ржмрзЗржи ржирж╛, ржЖржорж┐ ржЖржкржирж╛ржХрзЗ рж╕рж╛рж╣рж╛ржпрзНржп ржХрж░ржм! ЁЯж╕тАНтЩАя╕П\n\nтЬи ржЖржкржирж┐ ржПржЧрзБрж▓рзЛ ржХрж░рждрзЗ ржкрж╛рж░рзЗржи:\nтАв ржнрж╛рж▓рзБржХрзЗрж░ ржорждрзЛ ржмрж┐рж╢рзНрж░рж╛ржо ржирж┐ржи ЁЯР╗\nтАв ржкрзНрж░ржЪрзБрж░ ржкрж╛ржирж┐ ржкрж╛ржи ржХрж░рзБржи ЁЯМ▒\n\nржЖрж░ ржХрзЛржирзЛ рж▓ржХрзНрж╖ржг ржЖржЫрзЗ ржХрж┐? ЁЯдЧ",
        headache: "ржЖрж╣! ЁЯШФ ржорж╛ржерж╛ржмрзНржпржерж╛ рж╣ржЪрзНржЫрзЗ! ржПржХрж╕рж╛ржерзЗ ржПржЯрж╛ ржарж┐ржХ ржХрж░рж┐! ЁЯМЯ\n\nтЬи ржПржЧрзБрж▓рзЛ ржЪрзЗрж╖рзНржЯрж╛ ржХрж░рзБржи:\nтАв рж╢рж╛ржирзНржд, ржЕржирзНржзржХрж╛рж░ ржШрж░рзЗ ржмрж┐рж╢рзНрж░рж╛ржо ржирж┐ржи ЁЯПа\nтАв ржзрзАрж░рзЗ ржзрзАрж░рзЗ ржкрж╛ржирж┐ ржкрж╛ржи ржХрж░рзБржи ЁЯТз\n\nржорж╛ржерж╛ржмрзНржпржерж╛рж░ ржХрж╛рж░ржг ржХрзА ржоржирзЗ рж╣ржпрж╝? ЁЯдФ",
        cold: "рж╣рж╛ржБржЪрж┐! ЁЯдз ржЖржкржирж╛рж░ рж╕рж░рзНржжрж┐ рж╣ржпрж╝рзЗржЫрзЗ! ржЪрж┐ржирзНрждрж╛ ржХрж░ржмрзЗржи ржирж╛, рж╢рзАржШрзНрж░ржЗ ржнрж╛рж▓рзЛ рж╣ржпрж╝рзЗ ржпрж╛ржмрзЗ! ЁЯМИ\n\nтЬи ржПржХрж╕рж╛ржерзЗ ржПрж░ ржмрж┐рж░рзБржжрзНржзрзЗ рж▓ржбрж╝рж╛ржЗ ржХрж░рж┐:\nтАв ржкрзНрж░ржЪрзБрж░ ржмрж┐рж╢рзНрж░рж╛ржо ржирж┐ржи ЁЯШ┤\nтАв ржЧрж░ржо рж╕рзНржпрзБржк ржкрж╛ржи ржХрж░рзБржи ЁЯН▓\n\nрзн-рззрзж ржжрж┐ржирзЗ ржнрж╛рж▓рзЛ рж▓рж╛ржЧржмрзЗ! ЁЯТк",
        default: "рж╣рзНржпрж╛рж▓рзЛ ржЖржорж╛рж░ ржмржирзНржзрзБ! ЁЯШК ржЖржкржирж╛ржХрзЗ ржнрж╛рж▓рзЛ ржмрзЛржз ржХрж░рж╛рждрзЗ рж╕рж╛рж╣рж╛ржпрзНржп ржХрж░рждрзЗ ржЪрж╛ржЗ! ЁЯдЧ\n\nЁЯМЯ ржнрж╛рж▓рзЛ рж╕рж╛рж╣рж╛ржпрзНржпрзЗрж░ ржЬржирзНржп ржмрж▓рзБржи:\nтАв рж╢рж░рзАрж░рзЗрж░ ржХрзЛржи ржЕржВрж╢ ржнрж╛рж▓рзЛ рж▓рж╛ржЧржЫрзЗ ржирж╛?\nтАв ржХржмрзЗ ржерзЗржХрзЗ ржПржоржи рж▓рж╛ржЧржЫрзЗ?\n\nржЖржкржирж┐ ржЦрзБржм рж╕рж╛рж╣рж╕рзА! ЁЯж╕тАНтЩВя╕П"
      },
      es: {
        fever: "┬бOh no! ЁЯдТ ┬бTienes fiebre! ┬бNo te preocupes, estoy aqu├н para ayudarte! ЁЯж╕тАНтЩАя╕П\n\nтЬи Puedes hacer esto:\nтАв Descansa como un oso ЁЯР╗\nтАв Bebe mucha agua ЁЯМ▒\n\n┬┐Tienes otros s├нntomas? ЁЯдЧ",
        headache: "┬бAy! ЁЯШФ ┬бTe duele la cabeza! ┬бVamos a curarte juntos! ЁЯМЯ\n\nтЬи Prueba esto:\nтАв Descansa en una habitaci├│n tranquila y oscura ЁЯПа\nтАв Bebe agua lentamente ЁЯТз\n\n┬┐Qu├й crees que caus├│ tu dolor de cabeza? ЁЯдФ",
        cold: "┬бAch├нs! ЁЯдз ┬бTienes un resfriado! ┬бNo te preocupes, te sentir├бs mejor pronto! ЁЯМИ\n\nтЬи Luchemos contra esto juntos:\nтАв Descansa mucho ЁЯШ┤\nтАв Toma sopa caliente ЁЯН▓\n\n┬бTe sentir├бs mejor en 7-10 d├нas! ЁЯТк",
        default: "┬бHola mi amigo! ЁЯШК ┬бQuiero ayudarte a sentirte mejor! ЁЯдЧ\n\nЁЯМЯ Para ayudarte mejor, dime:\nтАв ┬┐Qu├й parte de tu cuerpo no se siente bien?\nтАв ┬┐Cu├бndo empezaste a sentirte as├н?\n\n┬бEres muy valiente! ЁЯж╕тАНтЩВя╕П"
      },
      fr: {
        fever: "Oh l├а l├а! ЁЯдТ Tu as de la fi├иvre! Ne t'inqui├иte pas, je suis l├а pour t'aider! ЁЯж╕тАНтЩАя╕П\n\nтЬи Tu peux faire ceci:\nтАв Repose-toi comme un ours ЁЯР╗\nтАв Bois beaucoup d'eau ЁЯМ▒\n\nAs-tu d'autres sympt├┤mes? ЁЯдЧ",
        headache: "A├пe! ЁЯШФ Tu as mal ├а la t├кte! Gu├йrissons-la ensemble! ЁЯМЯ\n\nтЬи Essaie ceci:\nтАв Repose-toi dans une chambre calme et sombre ЁЯПа\nтАв Bois de l'eau lentement ЁЯТз\n\nQu'est-ce qui a caus├й ton mal de t├кte? ЁЯдФ",
        cold: "Atchoum! ЁЯдз Tu as un rhume! Ne t'inqui├иte pas, tu iras mieux bient├┤t! ЁЯМИ\n\nтЬи Combattons cela ensemble:\nтАв Repose-toi beaucoup ЁЯШ┤\nтАв Bois de la soupe chaude ЁЯН▓\n\nTu iras mieux dans 7-10 jours! ЁЯТк",
        default: "Bonjour mon ami! ЁЯШК Je veux t'aider ├а te sentir mieux! ЁЯдЧ\n\nЁЯМЯ Pour mieux t'aider, dis-moi:\nтАв Quelle partie de ton corps ne va pas bien?\nтАв Quand as-tu commenc├й ├а te sentir ainsi?\n\nTu es tr├иs courageux! ЁЯж╕тАНтЩВя╕П"
      }
    };

    const languageResponses = responses[language as keyof typeof responses] || responses.en;
    
    if (lowerMessage.includes('fever') || lowerMessage.includes('рдмреБрдЦрд╛рд░') || lowerMessage.includes('р░Ьр▒Нр░╡р░░р░В') || lowerMessage.includes('роХро╛ропрпНроЪрпНроЪро▓рпН') || lowerMessage.includes('ржЬрзНржмрж░') || lowerMessage.includes('fiebre') || lowerMessage.includes('fi├иvre')) {
      return languageResponses.fever;
    } else if (lowerMessage.includes('headache') || lowerMessage.includes('рд╕рд┐рд░рджрд░реНрдж') || lowerMessage.includes('р░др░▓р░ир▒Кр░кр▒Нр░кр░┐') || lowerMessage.includes('родро▓рпИро╡ро▓ро┐') || lowerMessage.includes('ржорж╛ржерж╛ржмрзНржпржерж╛') || lowerMessage.includes('dolor de cabeza') || lowerMessage.includes('mal de t├кte')) {
      return languageResponses.headache;
    } else if (lowerMessage.includes('cold') || lowerMessage.includes('рд╕рд░реНрджреА') || lowerMessage.includes('р░Ьр░▓р▒Бр░мр▒Б') || lowerMessage.includes('роЪро│ро┐') || lowerMessage.includes('рж╕рж░рзНржжрж┐') || lowerMessage.includes('resfriado') || lowerMessage.includes('rhume')) {
      return languageResponses.cold;
    }
    
    return languageResponses.default;
  };

  const handleSendMessage = async () => {
    if (!inputText.trim()) return;

    const userMessage: Message = {
      id: Date.now().toString(),
      text: inputText,
      sender: 'user',
      timestamp: new Date(),
      language: selectedLanguage
    };

    setMessages(prev => [...prev, userMessage]);
    setInputText('');
    setIsTyping(true);

    // Simulate bot response delay
    setTimeout(() => {
      const botResponse: Message = {
        id: (Date.now() + 1).toString(),
        text: getMedicalResponse(inputText, selectedLanguage),
        sender: 'bot',
        timestamp: new Date(),
        language: selectedLanguage
      };

      setMessages(prev => [...prev, botResponse]);
      setIsTyping(false);
    }, 2000);
  };

  const handleKeyPress = (e: React.KeyboardEvent) => {
    if (e.key === 'Enter') {
      handleSendMessage();
    }
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 animate-fade-in">
      <div className="container mx-auto px-4 py-6 max-w-4xl">
        {/* Header */}
        <div className="flex items-center justify-between mb-6">
          <Button
            onClick={onBack}
            variant="outline"
            className="flex items-center gap-2 hover:scale-105 transition-transform"
          >
            <ArrowLeft className="h-4 w-4" />
            Back to Home
          </Button>
          <div className="flex items-center gap-2">
            <Globe className="h-5 w-5 text-blue-600 animate-pulse" />
            <Select value={selectedLanguage} onValueChange={setSelectedLanguage}>
              <SelectTrigger className="w-48 hover:scale-105 transition-transform">
                <SelectValue />
              </SelectTrigger>
              <SelectContent>
                {languages.map(lang => (
                  <SelectItem key={lang.code} value={lang.code}>
                    {lang.name}
                  </SelectItem>
                ))}
              </SelectContent>
            </Select>
          </div>
        </div>

        {/* Fun Medical Facts Banner */}
        <div className="mb-6 bg-gradient-to-r from-green-400 to-blue-500 text-white p-4 rounded-lg shadow-lg animate-scale-in">
          <div className="flex items-center gap-2 mb-2">
            <Stethoscope className="h-5 w-5 animate-pulse" />
            <span className="font-bold">ЁЯТб Did You Know?</span>
          </div>
          <p className="text-sm">Your heart beats about 100,000 times per day! That's like a super strong drum that never gets tired! ЁЯеБтЭдя╕П</p>
        </div>

        {/* Chat Interface */}
        <Card className="h-[600px] flex flex-col shadow-2xl hover:shadow-3xl transition-shadow duration-300">
          <CardHeader className="bg-gradient-to-r from-blue-600 to-purple-600 text-white">
            <CardTitle className="flex items-center gap-2">
              <Bot className="h-6 w-6 animate-bounce" />
              <Heart className="h-5 w-5 text-pink-300 animate-pulse" />
              Medical ChatBot - ArogyaMitra
              <Heart className="h-5 w-5 text-pink-300 animate-pulse" />
            </CardTitle>
          </CardHeader>
          
          <CardContent className="flex-1 flex flex-col p-0">
            {/* Messages */}
            <div className="flex-1 overflow-y-auto p-4 space-y-4">
              {messages.map((message) => (
                <div
                  key={message.id}
                  className={`flex ${message.sender === 'user' ? 'justify-end' : 'justify-start'} animate-fade-in`}
                >
                  <div
                    className={`max-w-xs lg:max-w-md px-4 py-2 rounded-lg shadow-md hover:shadow-lg transition-shadow duration-200 ${
                      message.sender === 'user'
                        ? 'bg-gradient-to-r from-blue-600 to-blue-700 text-white'
                        : 'bg-gradient-to-r from-green-50 to-blue-50 text-gray-800 border-2 border-blue-200'
                    }`}
                  >
                    <div className="flex items-center gap-2 mb-1">
                      {message.sender === 'user' ? (
                        <User className="h-4 w-4" />
                      ) : (
                        <Bot className="h-4 w-4 text-blue-600" />
                      )}
                      <span className="text-xs opacity-75">
                        {message.timestamp.toLocaleTimeString()}
                      </span>
                    </div>
                    <p className="whitespace-pre-line text-sm leading-relaxed">{message.text}</p>
                  </div>
                </div>
              ))}
              
              {isTyping && (
                <div className="flex justify-start animate-fade-in">
                  <div className="bg-gradient-to-r from-yellow-50 to-green-50 text-gray-800 px-4 py-2 rounded-lg border-2 border-yellow-200 shadow-md">
                    <div className="flex items-center gap-2">
                      <Bot className="h-4 w-4 text-blue-600" />
                      <span className="text-xs opacity-75">Doctor is thinking... ЁЯдФ</span>
                    </div>
                    <div className="flex space-x-1 mt-2">
                      <div className="w-2 h-2 bg-blue-400 rounded-full animate-bounce"></div>
                      <div className="w-2 h-2 bg-green-400 rounded-full animate-bounce" style={{animationDelay: '0.1s'}}></div>
                      <div className="w-2 h-2 bg-purple-400 rounded-full animate-bounce" style={{animationDelay: '0.2s'}}></div>
                    </div>
                  </div>
                </div>
              )}
              <div ref={messagesEndRef} />
            </div>

            {/* Input */}
            <div className="p-4 border-t bg-gradient-to-r from-blue-50 to-purple-50">
              <div className="flex gap-2">
                <Input
                  value={inputText}
                  onChange={(e) => setInputText(e.target.value)}
                  onKeyPress={handleKeyPress}
                  placeholder="Tell me how you're feeling... ЁЯШК"
                  className="flex-1 text-lg border-2 border-blue-300 focus:border-purple-400 hover:border-blue-400 transition-colors"
                  disabled={isTyping}
                />
                <Button
                  onClick={handleSendMessage}
                  disabled={!inputText.trim() || isTyping}
                  className="bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 hover:scale-105 transition-transform shadow-lg"
                >
                  <Send className="h-4 w-4" />
                </Button>
              </div>
            </div>
          </CardContent>
        </Card>
      </div>
    </div>
  );
};

export default ChatBot;
