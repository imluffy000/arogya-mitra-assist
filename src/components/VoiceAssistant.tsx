import { useState, useRef, useEffect } from 'react';
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import { ArrowLeft, Mic, MicOff, Volume2, VolumeX, Heart, Stethoscope, Play, Pause } from "lucide-react";
import { toast } from "@/hooks/use-toast";

interface VoiceAssistantProps {
  onBack: () => void;
}

const VoiceAssistant = ({ onBack }: VoiceAssistantProps) => {
  const [isListening, setIsListening] = useState(false);
  const [isSpeaking, setIsSpeaking] = useState(false);
  const [selectedLanguage, setSelectedLanguage] = useState('en');
  const [transcript, setTranscript] = useState('');
  const [response, setResponse] = useState('');
  const [volume, setVolume] = useState(1);
  const [speechRate, setSpeechRate] = useState(1);
  const [isVoiceEnabled, setIsVoiceEnabled] = useState(true);
  
  const recognitionRef = useRef<SpeechRecognition | null>(null);
  const synthRef = useRef<SpeechSynthesis | null>(null);
  const currentUtteranceRef = useRef<SpeechSynthesisUtterance | null>(null);

  const languages = [
    { code: 'en', name: 'English', voice: 'en-US' },
    { code: 'hi', name: 'рд╣рд┐рдВрджреА (Hindi)', voice: 'hi-IN' },
    { code: 'te', name: 'р░др▒Жр░▓р▒Бр░Чр▒Б (Telugu)', voice: 'te-IN' },
    { code: 'ta', name: 'родрооро┐ро┤рпН (Tamil)', voice: 'ta-IN' },
    { code: 'bn', name: 'ржмрж╛ржВрж▓рж╛ (Bengali)', voice: 'bn-IN' },
    { code: 'es', name: 'Espa├▒ol (Spanish)', voice: 'es-ES' },
    { code: 'fr', name: 'Fran├зais (French)', voice: 'fr-FR' }
  ];

  useEffect(() => {
    // Initialize speech synthesis
    if (typeof window !== 'undefined' && 'speechSynthesis' in window) {
      synthRef.current = window.speechSynthesis;
    }

    // Initialize speech recognition
    if (typeof window !== 'undefined') {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (SpeechRecognition) {
        recognitionRef.current = new SpeechRecognition();
        recognitionRef.current.continuous = false;
        recognitionRef.current.interimResults = false;
        
        recognitionRef.current.onstart = () => {
          console.log('Speech recognition started');
          setIsListening(true);
        };
        
        recognitionRef.current.onresult = (event) => {
          const transcript = event.results[0][0].transcript;
          console.log('Speech recognition result:', transcript);
          setTranscript(transcript);
          handleVoiceInput(transcript);
        };
        
        recognitionRef.current.onerror = (event) => {
          console.error('Speech recognition error:', event.error);
          setIsListening(false);
          toast({
            title: "Voice Error",
            description: "Sorry, I couldn't hear you clearly. Please try again! ЁЯШК",
            variant: "destructive",
          });
        };
        
        recognitionRef.current.onend = () => {
          console.log('Speech recognition ended');
          setIsListening(false);
        };
      }
    }

    // Cleanup function
    return () => {
      if (recognitionRef.current && isListening) {
        recognitionRef.current.stop();
      }
      if (synthRef.current) {
        synthRef.current.cancel();
      }
    };
  }, [selectedLanguage, isListening]);

  const handleVoiceInput = (transcript: string) => {
    const response = getMedicalResponse(transcript, selectedLanguage);
    setResponse(response);
    if (isVoiceEnabled) {
      speakResponse(response);
    }
  };

  const getMedicalResponse = (userInput: string, language: string): string => {
    const lowerInput = userInput.toLowerCase();
    
    // Enhanced responses for children and elderly
    const responses = {
      en: {
        fever: "Oh my! ЁЯдТ You have a fever! Let me help you feel better! Your body is like a brave soldier fighting germs! ЁЯж╕тАНтЩАя╕П\n\nHere's what heroes do:\nтАв Rest like a sleeping superhero ЁЯШ┤\nтАв Drink water like it's your super power! ЁЯТз\nтАв Take medicine only when grown-ups say it's okay ЁЯТК\nтАв Put a cool cloth on your forehead тЭДя╕П\n\nYou're so brave! Tell a grown-up if you feel worse, okay? ЁЯдЧ",
        headache: "Ouch! ЁЯШФ Your head hurts! Let's make it feel better together! ЁЯМЯ\n\nTry these magical remedies:\nтАв Rest in a quiet, cozy place ЁЯПа\nтАв Drink water slowly - your brain loves water! ЁЯзаЁЯТз\nтАв Breathe deeply like you're smelling beautiful flowers ЁЯМ╕\nтАв Ask someone to gently massage your temples ЁЯСР\n\nRemember, you're stronger than any headache! ЁЯТк",
        cough: "Cough, cough! ЁЯШ╖ Don't worry, coughing is your body's way of cleaning itself! ЁЯМкя╕П\n\nLet's help your throat feel better:\nтАв Drink warm honey water (nature's candy!) ЁЯНп\nтАв Breathe steam from a warm shower ЁЯЪ┐\nтАв Rest your voice like it's sleeping ЁЯШ┤\nтАв Gargle with warm salt water if you're old enough ЁЯзВ\n\nYou'll feel better soon, I promise! ЁЯМИ",
        default: "Hello there, brave friend! ЁЯШК I'm here to help you feel better! ЁЯдЧ\n\nTo give you the best help, can you tell me:\nтАв What part of your body doesn't feel good? ЁЯд╖тАНтЩАя╕П\nтАв When did you start feeling this way? тП░\nтАв What makes it feel better or worse? ЁЯдФ\n\nRemember, you're very brave for asking about your health! Always tell a grown-up you trust how you feel! ЁЯСитАНтЪХя╕ПЁЯСйтАНтЪХя╕П"
      },
      hi: {
        fever: "рдЕрд░реЗ рд╡рд╛рд╣! ЁЯдТ рдЖрдкрдХреЛ рдмреБрдЦрд╛рд░ рд╣реИ! рдореИрдВ рдЖрдкрдХреЛ рдмреЗрд╣рддрд░ рдорд╣рд╕реВрд╕ рдХрд░рд╛рдиреЗ рдореЗрдВ рдорджрдж рдХрд░реВрдВрдЧрд╛! рдЖрдкрдХрд╛ рд╢рд░реАрд░ рдПрдХ рдмрд╣рд╛рджреБрд░ рдпреЛрджреНрдзрд╛ рдХреА рддрд░рд╣ рдХреАрдЯрд╛рдгреБрдУрдВ рд╕реЗ рд▓рдбрд╝ рд░рд╣рд╛ рд╣реИ! ЁЯж╕тАНтЩАя╕П\n\nрд╡реАрд░ рдпреЛрджреНрдзрд╛ рдпрд╣ рдХрд░рддреЗ рд╣реИрдВ:\nтАв рд╕реБрдкрд░рд╣реАрд░реЛ рдХреА рддрд░рд╣ рд╕реЛрдХрд░ рдЖрд░рд╛рдо рдХрд░реЗрдВ ЁЯШ┤\nтАв рдкрд╛рдиреА рдХреЛ рдЕрдкрдиреА рд╢рдХреНрддрд┐ рд╕рдордЭрдХрд░ рдкрд┐рдПрдВ! ЁЯТз\nтАв рдмрдбрд╝реЗ рд▓реЛрдЧ рдХрд╣реЗрдВ рддреЛ рд╣реА рджрд╡рд╛ рд▓реЗрдВ ЁЯТК\n\nрдЖрдк рдмрд╣реБрдд рдмрд╣рд╛рджреБрд░ рд╣реИрдВ! рдЕрдЧрд░ рддрдмреАрдпрдд рдФрд░ рдЦрд░рд╛рдм рд▓рдЧреЗ рддреЛ рдХрд┐рд╕реА рдмрдбрд╝реЗ рдХреЛ рдмрддрд╛рдирд╛, рдареАрдХ рд╣реИ? ЁЯдЧ",
        headache: "рдЕрд░реЗ! ЁЯШФ рд╕рд┐рд░ рдореЗрдВ рджрд░реНрдж рд╣реЛ рд░рд╣рд╛ рд╣реИ! рдЪрд▓рд┐рдП рдорд┐рд▓рдХрд░ рдЗрд╕реЗ рдареАрдХ рдХрд░рддреЗ рд╣реИрдВ! ЁЯМЯ\n\nрдпреЗ рдЬрд╛рджреБрдИ рдЙрдкрд╛рдп рдХрд░реЗрдВ:\nтАв рд╢рд╛рдВрдд рдЬрдЧрд╣ рдЖрд░рд╛рдо рдХрд░реЗрдВ ЁЯПа\nтАв рдзреАрд░реЗ-рдзреАрд░реЗ рдкрд╛рдиреА рдкрд┐рдПрдВ ЁЯТз\nтАв рдлреВрд▓реЛрдВ рдХреА рддрд░рд╣ рд╕рд╛рдВрд╕ рд▓реЗрдВ ЁЯМ╕\n\nрдпрд╛рдж рд░рдЦреЗрдВ, рдЖрдк рдХрд┐рд╕реА рднреА рд╕рд┐рд░рджрд░реНрдж рд╕реЗ рдЬреНрдпрд╛рджрд╛ рдордЬрдмреВрдд рд╣реИрдВ! ЁЯТк",
        cough: "рдЦрд╛рдВрд╕реА рдЖ рд░рд╣реА рд╣реИ! ЁЯШ╖ рдЪрд┐рдВрддрд╛ рди рдХрд░реЗрдВ, рдЦрд╛рдВрд╕реА рдЖрдкрдХреЗ рд╢рд░реАрд░ рдХреЗ рд╕рд╛рдл рд╣реЛрдиреЗ рдХрд╛ рддрд░реАрдХрд╛ рд╣реИ! ЁЯМкя╕П\n\nрдЧрд▓реЗ рдХреЛ рдмреЗрд╣рддрд░ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП:\nтАв рдЧрд░реНрдо рд╢рд╣рдж рдХрд╛ рдкрд╛рдиреА рдкрд┐рдПрдВ ЁЯНп\nтАв рдЧрд░реНрдо рдкрд╛рдиреА рдХреА рднрд╛рдк рд▓реЗрдВ ЁЯЪ┐\nтАв рдЖрд╡рд╛рдЬрд╝ рдХреЛ рдЖрд░рд╛рдо рджреЗрдВ ЁЯШ┤\n\nрдЬрд▓реНрджреА рдареАрдХ рд╣реЛ рдЬрд╛рдПрдВрдЧреЗ! ЁЯМИ",
        default: "рдирдорд╕реНрддреЗ рдмрд╣рд╛рджреБрд░ рджреЛрд╕реНрдд! ЁЯШК рдореИрдВ рдЖрдкрдХреЛ рдмреЗрд╣рддрд░ рдорд╣рд╕реВрд╕ рдХрд░рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдпрд╣рд╛рдБ рд╣реВрдБ! ЁЯдЧ\n\nрдмреЗрд╣рддрд░ рдорджрдж рдХреЗ рд▓рд┐рдП рдмрддрд╛рдЗрдП:\nтАв рд╢рд░реАрд░ рдХрд╛ рдХреМрди рд╕рд╛ рд╣рд┐рд╕реНрд╕рд╛ рдареАрдХ рдирд╣реАрдВ рд▓рдЧ рд░рд╣рд╛? ЁЯд╖тАНтЩАя╕П\nтАв рдпрд╣ рдХрдм рд╕реЗ рд╣реЛ рд░рд╣рд╛ рд╣реИ? тП░\n\nрдЖрдк рдЕрдкрдиреЗ рд╕реНрд╡рд╛рд╕реНрдереНрдп рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдкреВрдЫрдиреЗ рдХреЗ рд▓рд┐рдП рдмрд╣реБрдд рдмрд╣рд╛рджреБрд░ рд╣реИрдВ! ЁЯСитАНтЪХя╕ПЁЯСйтАНтЪХя╕П"
      },
      te: {
        fever: "р░Ер░пр▒Нр░пр▒Л! ЁЯдТ р░ор▒Ар░Хр▒Б р░Ьр▒Нр░╡р░░р░В р░╡р░Ър▒Нр░Ър░┐р░Вр░жр░╛! р░ир▒Зр░ир▒Б р░ор▒Ар░Хр▒Б р░ор░Вр░Ър░┐р░Чр░╛ р░Ер░ир░┐р░кр░┐р░Вр░Ър▒Зр░▓р░╛ р░Ър▒Зр░╕р▒Нр░др░╛р░ир▒Б! ЁЯж╕тАНтЩАя╕П",
        headache: "р░Ер░пр▒Нр░пр▒Л! ЁЯШФ р░др░▓ р░ир▒Кр░кр▒Нр░кр░┐р░Чр░╛ р░Йр░Вр░жр░╛! р░Хр░▓р░┐р░╕р░┐ р░жр░╛р░ир▒Нр░ир░┐ р░мр░╛р░Чр▒Б р░Ър▒Зр░жр▒Нр░жр░╛р░В! ЁЯМЯ",
        cough: "р░жр░Чр▒Н р░Чр▒Бр░ор▒Н! ЁЯШ╖ р░Ър░┐р░Вр░д р░Ър▒Зр░пр░Хр░Вр░бр░┐, р░жр░Чр▒Нр░Чр▒Б р░ор▒А р░╢р░░р▒Ар░░р░В р░╢р▒Бр░нр▒Нр░░р░В р░Ър▒Зр░╕р▒Бр░Хр▒Лр░╡р░бр░╛р░ир░┐р░Хр░┐! ЁЯМкя╕П",
        default: "р░ир░ор░╕р▒Нр░Хр░╛р░░р░В р░зр▒Ир░░р▒Нр░пр░╡р░Вр░др▒Бр░бр░╛! ЁЯШК р░ор▒Ар░Хр▒Б р░ор░Вр░Ър░┐р░Чр░╛ р░Ер░ир░┐р░кр░┐р░Вр░Ър▒Зр░▓р░╛ р░╕р░╣р░╛р░пр░В р░Ър▒Зр░пр░бр░╛р░ир░┐р░Хр░┐ р░ир▒Зр░ир▒Б р░Зр░Хр▒Нр░Хр░б р░Йр░ир▒Нр░ир░╛р░ир▒Б! ЁЯдЧ"
      },
      ta: {
        fever: "роЕропрпНропрпЛ! ЁЯдТ роЙроЩрпНроХро│рпБроХрпНроХрпБ роХро╛ропрпНроЪрпНроЪро▓рпН ро╡роирпНродрпБро│рпНро│родрпБ! роиро╛ройрпН роЙроЩрпНроХро│рпБроХрпНроХрпБ роиро▓рпНро▓родрпБ рокрпЛро▓рпН роЙрогро░ ро╡рпИрокрпНрокрпЗройрпН! ЁЯж╕тАНтЩАя╕П",
        headache: "роЕропрпНропрпЛ! ЁЯШФ родро▓рпИро╡ро▓ро┐ роЗро░рпБроХрпНроХро┐ро▒родро╛! роЪрпЗро░рпНроирпНродрпБ роЕродрпИ роЪро░ро┐ роЪрпЖропрпНро╡рпЛроорпН! ЁЯМЯ",
        cough: "роЗро░рпБрооро▓рпН! ЁЯШ╖ роХро╡ро▓рпИрокрпНрокроЯро╛родрпАро░рпНроХро│рпН, роЗро░рпБрооро▓рпН роЙроЩрпНроХро│рпН роЙроЯро▓рпИ роЪрпБродрпНродрокрпНрокроЯрпБродрпНродрпБроорпН ро╡ро┤ро┐! ЁЯМкя╕П",
        default: "ро╡рогроХрпНроХроорпН родрпИро░ро┐ропрооро╛рой роирогрпНрокро░рпЗ! ЁЯШК роЙроЩрпНроХро│рпБроХрпНроХрпБ роиро▓рпНро▓родрпБ рокрпЛро▓рпН роЙрогро░ роЙродро╡ роиро╛ройрпН роЗроЩрпНроХрпЗ роЗро░рпБроХрпНроХро┐ро▒рпЗройрпН! ЁЯдЧ"
      },
      bn: {
        fever: "рж╣рж╛ржпрж╝! ЁЯдТ ржЖржкржирж╛рж░ ржЬрзНржмрж░ рж╣ржпрж╝рзЗржЫрзЗ! ржЖржорж┐ ржЖржкржирж╛ржХрзЗ ржнрж╛рж▓рзЛ ржмрзЛржз ржХрж░рж╛ржм! ЁЯж╕тАНтЩАя╕П",
        headache: "ржЖрж╣! ЁЯШФ ржорж╛ржерж╛ржмрзНржпржерж╛ рж╣ржЪрзНржЫрзЗ! ржПржХрж╕рж╛ржерзЗ ржПржЯрж╛ ржарж┐ржХ ржХрж░рж┐! ЁЯМЯ",
        cough: "ржХрж╛рж╢рж┐! ЁЯШ╖ ржЪрж┐ржирзНрждрж╛ ржХрж░ржмрзЗржи ржирж╛, ржХрж╛рж╢рж┐ ржЖржкржирж╛рж░ рж╢рж░рзАрж░ ржкрж░рж┐рж╖рзНржХрж╛рж░ ржХрж░рж╛рж░ ржЙржкрж╛ржпрж╝! ЁЯМкя╕П",
        default: "ржиржорж╕рзНржХрж╛рж░ рж╕рж╛рж╣рж╕рзА ржмржирзНржзрзБ! ЁЯШК ржЖржкржирж╛ржХрзЗ ржнрж╛рж▓рзЛ ржмрзЛржз ржХрж░рж╛рждрзЗ ржЖржорж┐ ржПржЦрж╛ржирзЗ ржЖржЫрж┐! ЁЯдЧ"
      },
      es: {
        fever: "┬бAy, no! ЁЯдТ ┬бTienes fiebre! ┬бTe ayudar├й a sentirte mejor! ЁЯж╕тАНтЩАя╕П",
        headache: "┬бAy! ЁЯШФ ┬бTe duele la cabeza! ┬бVamos a curarte juntos! ЁЯМЯ",
        cough: "┬бTos! ЁЯШ╖ ┬бNo te preocupes, toser es la forma de tu cuerpo de limpiarse! ЁЯМкя╕П",
        default: "┬бHola amigo valiente! ЁЯШК ┬бEstoy aqu├н para ayudarte a sentirte mejor! ЁЯдЧ"
      },
      fr: {
        fever: "Oh l├а l├а! ЁЯдТ Tu as de la fi├иvre! Je vais t'aider ├а te sentir mieux! ЁЯж╕тАНтЩАя╕П",
        headache: "A├пe! ЁЯШФ Tu as mal ├а la t├кte! Gu├йrissons-la ensemble! ЁЯМЯ",
        cough: "Toux! ЁЯШ╖ Ne t'inqui├иte pas, tousser est la fa├зon de ton corps de se nettoyer! ЁЯМкя╕П",
        default: "Bonjour ami courageux! ЁЯШК Je suis l├а pour t'aider ├а te sentir mieux! ЁЯдЧ"
      }
    };

    const languageResponses = responses[language as keyof typeof responses] || responses.en;
    
    if (lowerInput.includes('fever') || lowerInput.includes('рдмреБрдЦрд╛рд░') || lowerInput.includes('р░Ьр▒Нр░╡р░░р░В') || lowerInput.includes('роХро╛ропрпНроЪрпНроЪро▓рпН') || lowerInput.includes('ржЬрзНржмрж░') || lowerInput.includes('fiebre') || lowerInput.includes('fi├иvre')) {
      return languageResponses.fever;
    } else if (lowerInput.includes('headache') || lowerInput.includes('рд╕рд┐рд░рджрд░реНрдж') || lowerInput.includes('р░др░▓р░ир▒Кр░кр▒Нр░кр░┐') || lowerInput.includes('родро▓рпИро╡ро▓ро┐') || lowerInput.includes('ржорж╛ржерж╛ржмрзНржпржерж╛') || lowerInput.includes('dolor de cabeza') || lowerInput.includes('mal de t├кte')) {
      return languageResponses.headache;
    } else if (lowerInput.includes('cough') || lowerInput.includes('рдЦрд╛рдВрд╕реА') || lowerInput.includes('р░жр░Чр▒Нр░Чр▒Б') || lowerInput.includes('роЗро░рпБрооро▓рпН') || lowerInput.includes('ржХрж╛рж╢рж┐') || lowerInput.includes('tos') || lowerInput.includes('toux')) {
      return languageResponses.cough;
    }
    
    return languageResponses.default;
  };

  const speakResponse = (text: string) => {
    if (!synthRef.current || !isVoiceEnabled) return;

    // Cancel any ongoing speech
    synthRef.current.cancel();

    const utterance = new SpeechSynthesisUtterance(text);
    const selectedLang = languages.find(lang => lang.code === selectedLanguage);
    
    utterance.lang = selectedLang?.voice || 'en-US';
    utterance.volume = volume;
    utterance.rate = speechRate;
    utterance.pitch = 1.2; // Slightly higher pitch for friendliness
    
    utterance.onstart = () => {
      setIsSpeaking(true);
    };
    
    utterance.onend = () => {
      setIsSpeaking(false);
      currentUtteranceRef.current = null;
    };
    
    utterance.onerror = (event) => {
      console.error('Speech synthesis error:', event.error);
      setIsSpeaking(false);
      currentUtteranceRef.current = null;
    };

    currentUtteranceRef.current = utterance;
    synthRef.current.speak(utterance);
  };

  const startListening = () => {
    if (!recognitionRef.current) {
      toast({
        title: "Voice Not Supported",
        description: "Sorry, voice recognition is not supported in your browser! ЁЯШЕ",
        variant: "destructive",
      });
      return;
    }

    const selectedLang = languages.find(lang => lang.code === selectedLanguage);
    recognitionRef.current.lang = selectedLang?.voice || 'en-US';
    
    try {
      recognitionRef.current.start();
      toast({
        title: "Listening! ЁЯСВ",
        description: "Speak now! I'm listening to help you! ЁЯШК",
      });
    } catch (error) {
      console.error('Error starting recognition:', error);
      toast({
        title: "Error",
        description: "Couldn't start listening. Please try again! ЁЯШЕ",
        variant: "destructive",
      });
    }
  };

  const stopListening = () => {
    if (recognitionRef.current && isListening) {
      recognitionRef.current.stop();
    }
  };

  const stopSpeaking = () => {
    if (synthRef.current && isSpeaking) {
      synthRef.current.cancel();
      setIsSpeaking(false);
    }
  };

  const toggleVoice = () => {
    setIsVoiceEnabled(!isVoiceEnabled);
    if (!isVoiceEnabled) {
      stopSpeaking();
    }
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-blue-50 animate-fade-in">
      <div className="container mx-auto px-4 py-6 max-w-4xl">
        {/* Header */}
        <div className="flex items-center justify-between mb-6">
          <Button
            onClick={onBack}
            variant="outline"
            className="flex items-center gap-2 hover:scale-105 transition-transform"
          >
            <ArrowLeft className="h-4 w-4" />
            Back to Home
          </Button>
          <div className="flex items-center gap-2">
            <Select value={selectedLanguage} onValueChange={setSelectedLanguage}>
              <SelectTrigger className="w-48 hover:scale-105 transition-transform">
                <SelectValue />
              </SelectTrigger>
              <SelectContent>
                {languages.map(lang => (
                  <SelectItem key={lang.code} value={lang.code}>
                    {lang.name}
                  </SelectItem>
                ))}
              </SelectContent>
            </Select>
          </div>
        </div>

        {/* Health Tip Banner */}
        <div className="mb-6 bg-gradient-to-r from-pink-400 to-purple-500 text-white p-4 rounded-lg shadow-lg animate-scale-in">
          <div className="flex items-center gap-2 mb-2">
            <Heart className="h-5 w-5 animate-pulse" />
            <span className="font-bold">ЁЯТЭ Health Tip for Everyone!</span>
          </div>
          <p className="text-sm">Drinking water is like giving your body a big, refreshing hug! Try to drink 8 glasses a day! ЁЯедтЬи</p>
        </div>

        {/* Voice Assistant Interface */}
        <Card className="shadow-2xl hover:shadow-3xl transition-shadow duration-300">
          <CardHeader className="bg-gradient-to-r from-purple-600 to-pink-600 text-white">
            <CardTitle className="flex items-center gap-2 justify-center text-2xl">
              <Stethoscope className="h-6 w-6 animate-pulse" />
              <Heart className="h-5 w-5 text-pink-300 animate-bounce" />
              Voice Assistant - ArogyaMitra
              <Heart className="h-5 w-5 text-pink-300 animate-bounce" />
            </CardTitle>
          </CardHeader>
          
          <CardContent className="p-8 space-y-6">
            {/* Main Voice Controls */}
            <div className="flex flex-col items-center space-y-6">
              <div className="relative">
                <Button
                  onClick={isListening ? stopListening : startListening}
                  disabled={isSpeaking}
                  className={`w-32 h-32 rounded-full text-white font-bold text-lg shadow-2xl hover:shadow-3xl transition-all duration-300 ${
                    isListening 
                      ? 'bg-gradient-to-r from-red-500 to-pink-500 animate-pulse hover:from-red-600 hover:to-pink-600' 
                      : 'bg-gradient-to-r from-green-500 to-blue-500 hover:from-green-600 hover:to-blue-600 hover:scale-110'
                  }`}
                >
                  {isListening ? (
                    <>
                      <MicOff className="h-12 w-12 mb-2" />
                      Stop
                    </>
                  ) : (
                    <>
                      <Mic className="h-12 w-12 mb-2" />
                      Talk to Me!
                    </>
                  )}
                </Button>
                
                {/* Listening Animation */}
                {isListening && (
                  <div className="absolute -inset-4 border-4 border-green-400 rounded-full animate-ping"></div>
                )}
              </div>

              {/* Voice Controls */}
              <div className="flex items-center gap-4">
                <Button
                  onClick={toggleVoice}
                  variant="outline"
                  className="flex items-center gap-2 hover:scale-105 transition-transform"
                >
                  {isVoiceEnabled ? (
                    <>
                      <Volume2 className="h-4 w-4" />
                      Voice On
                    </>
                  ) : (
                    <>
                      <VolumeX className="h-4 w-4" />
                      Voice Off
                    </>
                  )}
                </Button>
                
                {isSpeaking && (
                  <Button
                    onClick={stopSpeaking}
                    variant="outline"
                    className="flex items-center gap-2 hover:scale-105 transition-transform animate-pulse"
                  >
                    <Pause className="h-4 w-4" />
                    Stop Speaking
                  </Button>
                )}
              </div>
            </div>

            {/* Speech Rate and Volume Controls */}
            <div className="grid md:grid-cols-2 gap-4">
              <div className="space-y-2">
                <label className="text-sm font-medium">Speaking Speed: {speechRate}x</label>
                <input
                  type="range"
                  min="0.5"
                  max="2"
                  step="0.1"
                  value={speechRate}
                  onChange={(e) => setSpeechRate(parseFloat(e.target.value))}
                  className="w-full h-2 bg-purple-200 rounded-lg appearance-none cursor-pointer"
                />
              </div>
              
              <div className="space-y-2">
                <label className="text-sm font-medium">Volume: {Math.round(volume * 100)}%</label>
                <input
                  type="range"
                  min="0"
                  max="1"
                  step="0.1"
                  value={volume}
                  onChange={(e) => setVolume(parseFloat(e.target.value))}
                  className="w-full h-2 bg-purple-200 rounded-lg appearance-none cursor-pointer"
                />
              </div>
            </div>

            {/* Transcript Display */}
            {transcript && (
              <div className="bg-gradient-to-r from-blue-50 to-purple-50 p-4 rounded-lg border-2 border-blue-200 animate-fade-in">
                <h3 className="font-semibold mb-2 flex items-center gap-2">
                  <Mic className="h-4 w-4 text-blue-600" />
                  You said:
                </h3>
                <p className="text-gray-700 italic">"{transcript}"</p>
              </div>
            )}

            {/* Response Display */}
            {response && (
              <div className="bg-gradient-to-r from-green-50 to-pink-50 p-4 rounded-lg border-2 border-green-200 animate-fade-in">
                <h3 className="font-semibold mb-2 flex items-center gap-2">
                  <Heart className="h-4 w-4 text-green-600" />
                  ArogyaMitra says:
                </h3>
                <p className="text-gray-700 whitespace-pre-line leading-relaxed">{response}</p>
              </div>
            )}

            {/* Status Indicators */}
            <div className="flex justify-center gap-4 text-sm">
              {isListening && (
                <div className="flex items-center gap-2 text-green-600 animate-pulse">
                  <div className="w-2 h-2 bg-green-500 rounded-full"></div>
                  Listening...
                </div>
              )}
              {isSpeaking && (
                <div className="flex items-center gap-2 text-blue-600 animate-pulse">
                  <div className="w-2 h-2 bg-blue-500 rounded-full"></div>
                  Speaking...
                </div>
              )}
            </div>

            {/* Instructions */}
            <div className="bg-gradient-to-r from-yellow-50 to-orange-50 p-4 rounded-lg border-2 border-yellow-200">
              <h3 className="font-semibold mb-2 text-center">ЁЯМЯ How to Use Voice Assistant ЁЯМЯ</h3>
              <ul className="space-y-1 text-sm">
                <li>тАв ЁЯОд Click "Talk to Me!" button to start speaking</li>
                <li>тАв ЁЯЧгя╕П Tell me about your symptoms or ask health questions</li>
                <li>тАв ЁЯФК I'll speak back to you in your chosen language</li>
                <li>тАв ЁЯОЫя╕П Adjust speed and volume for your comfort</li>
                <li>тАв ЁЯСитАНтЪХя╕П Always consult a real doctor for serious concerns!</li>
              </ul>
            </div>
          </CardContent>
        </Card>
      </div>
    </div>
  );
};

export default VoiceAssistant;
